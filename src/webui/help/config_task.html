<!DOCTYPE html> <html lang=ru > <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="_static/stylesheets/application.css"/> <link rel=stylesheet  href="_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="_static/fonts/material-icons.css"/> <meta name=theme-color  content="#3f51b5"> <script src="_static/javascripts/modernizr.js"></script> <title>Секция Task &#8212; Lootnika Docs</title> <link rel=stylesheet  href="_static/material.css" type="text/css" /> <link rel=stylesheet  href="_static/pygments.css" type="text/css" /> <script id=documentation_options  data-url_root="./" src="_static/documentation_options.js"></script> <script src="_static/jquery.js"></script> <script src="_static/underscore.js"></script> <script src="_static/doctools.js"></script> <script src="_static/language_data.js"></script> <script src="_static/translations.js"></script> <link rel=index  title="Алфавитный указатель" href=genindex.html  /> <link rel=search  title="Поиск" href=search.html  /> <link rel=next  title="Команды" href=api.html  /> <link rel=prev  title="Секция Export" href=config_export.html  /> <body dir=ltr data-md-color-primary=light-green data-md-color-accent=blue> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#config_task" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href=index.html  title="Lootnika Docs" class="md-header-nav__button md-logo"> &nbsp; </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >Lootnika</span> <span class=md-header-nav__topic > Секция Task </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action=search.html  method=GET  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <script src="_static/javascripts/version_dropdown.js"></script> <script> var json_loc = ""versions.json"", target_loc = "../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <!-- <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href=index.html  class=md-tabs__link >Lootnika Docs</a> <li class=md-tabs__item ><a href=config.html  class=md-tabs__link >Настройки</a> </ul> </div> </nav> --> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href=index.html  title="Lootnika Docs" class="md-nav__button md-logo"> <img src="_static/" alt=" logo" width=48  height=48 > </a> <a href=index.html  title="Lootnika Docs">Lootnika</a> </label> <ul class=md-nav__list > <li class=md-nav__item > <a href=config.html  class=md-nav__link >Настройки</a> <ul class=md-nav__list > <li class=md-nav__item > <a href=syntax.html  class=md-nav__link >Синтаксис настроек</a> <li class=md-nav__item > <a href=config_server.html  class=md-nav__link >Секция Server</a> <li class=md-nav__item > <a href=config_service.html  class=md-nav__link >Секция Service</a> <li class=md-nav__item > <a href=config_logging.html  class=md-nav__link >Секция Logging</a> <li class=md-nav__item > <a href=config_diskUsage.html  class=md-nav__link >Секция DiskUsage</a> <li class=md-nav__item > <a href=config_schedule.html  class=md-nav__link >Секция Schedule</a> <li class=md-nav__item > <a href=config_export.html  class=md-nav__link >Секция Export</a> <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Секция Task </label> <a href="#" class="md-nav__link md-nav__link--active">Секция Task</a> <nav class="md-nav md-nav--secondary"> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a class=md-nav__extra_link  href="_sources/config_task.rst.txt">Исходный текст</a> </ul> </nav> <ul class=md-nav__list > <li class=md-nav__item > <a href="#exporter" class=md-nav__link >Exporter</a> <li class=md-nav__item > <a href="#overwritetaskstore" class=md-nav__link >OverwriteTaskstore</a> <li class=md-nav__item > <a href="#dbhost" class=md-nav__link >DBhost</a> <li class=md-nav__item > <a href="#dbport" class=md-nav__link >DBport</a> <li class=md-nav__item > <a href="#dbscheme" class=md-nav__link >DBscheme</a> <li class=md-nav__item > <a href="#dbusr" class=md-nav__link >DBusr</a> <li class=md-nav__item > <a href="#dbpsw" class=md-nav__link >DBpsw</a> <li class=md-nav__item > <a href="#id2" class=md-nav__link >DBusr</a> <li class=md-nav__item > <a href="#skipemptyrows" class=md-nav__link >SkipEmptyRows</a> <li class=md-nav__item > <a href="#docref" class=md-nav__link >DocRef</a> <li class=md-nav__item > <a href="#selectid" class=md-nav__link >SelectID</a> <li class=md-nav__item > <a href="#id3" class=md-nav__link >SelectFields</a> <li class=md-nav__item > <a href="#bundlename" class=md-nav__link >BundleName</a> <li class=md-nav__item > <a href="#id6" class=md-nav__link >SelectBundle</a> </ul> </ul> <li class=md-nav__item > <a href=api.html  class=md-nav__link >Команды</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a class=md-nav__extra_link  href="_sources/config_task.rst.txt">Исходный текст</a> <li id=searchbox  class=md-nav__item > </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <h1 id=config-task--page-root >Секция Task<a class=headerlink  href="#config-task--page-root" title="Ссылка на этот заголовок">¶</a></h1> <p>Параметры заданий.</p> <p>Каждое задание должно иметь свою секцию. Название секции должно совпадать со значением объявленное в <a class="reference internal" href=config_schedule.html ><span class=doc >Schedule</span></a>.</p> <div class="admonition attention"> <p class=admonition-title >Внимание</p> <p>Все нижеописанные параметры относятся к сборщику <strong>lootnika_mysql</strong></p> </div> <p>Доступны следующие параметры:</p> <div class="contents local topic" id=id1 > <ul class=simple > <li><p><a class="reference internal" href="#exporter" id=id9 >Exporter</a></p> <li><p><a class="reference internal" href="#overwritetaskstore" id=id10 >OverwriteTaskstore</a></p> <li><p><a class="reference internal" href="#dbhost" id=id11 >DBhost</a></p> <li><p><a class="reference internal" href="#dbport" id=id12 >DBport</a></p> <li><p><a class="reference internal" href="#dbscheme" id=id13 >DBscheme</a></p> <li><p><a class="reference internal" href="#dbusr" id=id14 >DBusr</a></p> <li><p><a class="reference internal" href="#dbpsw" id=id15 >DBpsw</a></p> <li><p><a class="reference internal" href="#id2" id=id16 >DBusr</a></p> <li><p><a class="reference internal" href="#skipemptyrows" id=id17 >SkipEmptyRows</a></p> <li><p><a class="reference internal" href="#docref" id=id18 >DocRef</a></p> <li><p><a class="reference internal" href="#selectid" id=id19 >SelectID</a></p> <li><p><a class="reference internal" href="#id3" id=id20 >SelectFields</a></p> <li><p><a class="reference internal" href="#bundlename" id=id21 >BundleName</a></p> <li><p><a class="reference internal" href="#id6" id=id22 >SelectBundle</a></p> </ul> </div> <h2 id=exporter ><a class=toc-backref  href="#id9">Exporter</a><a class=headerlink  href="#exporter" title="Ссылка на этот заголовок">¶</a></h2> <p>Ссылка на экспортёр.</p> <p>Вы можете использовать одновременно несколько разных экспортёров, а так же назначить для каждого задания свой (см. <a class="reference internal" href=config_export.html ><span class=doc >Export</span></a>.). Это необязательный параметр и в случае его отсутствия Лутника будет использовать секцию <code class="docutils literal notranslate"><span class=pre >[export]</span></code></p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >Exporter</span> <span class=o >=</span> <span class=s >mail2csv</span>
</pre></div> </div> <div class="admonition note"> <p class=admonition-title >Примечание</p> <p>Этот параметр доступен для любого типа сборщика</p> </div> <h2 id=overwritetaskstore ><a class=toc-backref  href="#id10">OverwriteTaskstore</a><a class=headerlink  href="#overwritetaskstore" title="Ссылка на этот заголовок">¶</a></h2> <p>Создать новый журнал задания.</p> <p>Каждое задание создаёт свою БД в которой записываются данные о документах. Эти данные используются для отслеживания изменений в источнике при следующем выполнении. Если активировать этот параметр, то при каждом выполнении задании будет создаваться новый журнал заданий.</p> <p>Это не обязательный параметр и по умолчанию используется <code class="docutils literal notranslate"><span class=pre >False</span></code>.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >OverwriteTaskstore</span> <span class=o >=</span> <span class=s >True</span>
</pre></div> </div> <div class="admonition attention"> <p class=admonition-title >Внимание</p> <p>При активации параметра все документы будут отмечены как новые, а информация о старых будет утеряна</p> </div> <div class="admonition note"> <p class=admonition-title >Примечание</p> <p>Этот параметр доступен для любого типа сборщика</p> </div> <h2 id=dbhost ><a class=toc-backref  href="#id11">DBhost</a><a class=headerlink  href="#dbhost" title="Ссылка на этот заголовок">¶</a></h2> <p>Адрес сервера БД MySQL.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >dbHost</span><span class=o >=</span><span class=s >192.291.11.22</span>
<span class=na >dbHost</span><span class=o >=</span><span class=s >RepoServer</span>
</pre></div> </div> <h2 id=dbport ><a class=toc-backref  href="#id12">DBport</a><a class=headerlink  href="#dbport" title="Ссылка на этот заголовок">¶</a></h2> <p>Порт БД источника.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >dbPort</span><span class=o >=</span><span class=s >3306</span>
</pre></div> </div> <h2 id=dbscheme ><a class=toc-backref  href="#id13">DBscheme</a><a class=headerlink  href="#dbscheme" title="Ссылка на этот заголовок">¶</a></h2> <p>Название схемы таблиц в БД источника.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >dbScheme</span><span class=o >=</span><span class=s >forum</span>
</pre></div> </div> <h2 id=dbusr ><a class=toc-backref  href="#id14">DBusr</a><a class=headerlink  href="#dbusr" title="Ссылка на этот заголовок">¶</a></h2> <p>Учётная запись которая будет использоваться для подключения к базе данных источника.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >DBusr</span><span class=o >=</span><span class=s >lootnika</span>
</pre></div> </div> <h2 id=dbpsw ><a class=toc-backref  href="#id15">DBpsw</a><a class=headerlink  href="#dbpsw" title="Ссылка на этот заголовок">¶</a></h2> <p>Учётная запись которая будет использоваться для подключения к базе данных источника.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >DBpsw</span><span class=o >=</span><span class=s >strongpswd</span>
</pre></div> </div> <h2 id=id2 ><a class=toc-backref  href="#id16">DBusr</a><a class=headerlink  href="#id2" title="Ссылка на этот заголовок">¶</a></h2> <p>Учётная запись которая будет использоваться для подключения к базе данных источника.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >dbPort</span><span class=o >=</span><span class=s >3306</span>
</pre></div> </div> <h2 id=skipemptyrows ><a class=toc-backref  href="#id17">SkipEmptyRows</a><a class=headerlink  href="#skipemptyrows" title="Ссылка на этот заголовок">¶</a></h2> <p>Булево значение отвечающее за пропуск пустых строк.</p> <p>Испльзуйте этот параметр если не хотите чтобы пустые строки попадали в документ. При активации этого параметра, если запрос вернёт пустую строку, коннектор подставит для каждого поля значение <code class="docutils literal notranslate"><span class=pre >None</span></code></p> <p>По умолчанию используется значение <code class="docutils literal notranslate"><span class=pre >True</span></code></p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SkipEmptyRows</span><span class=o >=</span><span class=s >True</span>
</pre></div> </div> <h2 id=docref ><a class=toc-backref  href="#id18">DocRef</a><a class=headerlink  href="#docref" title="Ссылка на этот заголовок">¶</a></h2> <p>Шаблон создания идентификаторов документов.</p> <p>Reference должен быть уникальным для каждого документа. В нём можно использовать метаданные самого документа, например: его id, номер, название и т.д.</p> <p>Используйте только те поля, которые всегда присутствуют документе. Если нужного поля не окажется в метаданных , то документ не будет создан, а значит не будет передан на экспорт. Если документ не имеет уникальных полей, используйте комбинацию различных полей и других указателей.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >DocRef</span><span class=o >=</span><span class=s >some_doc_@loot_id@</span>
<span class=na >DocRef</span><span class=o >=</span><span class=s >document_@number@</span>
<span class=na >DocRef</span><span class=o >=</span><span class=s >@id@-@name@-@data@</span>
</pre></div> </div> <p>Независимо от набора полей документа, вы всегда можете использовать его идентификатор в источнике <code class="docutils literal notranslate"><span class=pre >loot_id</span></code> (см. <a class="reference external" href="#SelectFields">SelectFields</a>).</p> <h2 id=selectid ><a class=toc-backref  href="#id19">SelectID</a><a class=headerlink  href="#selectid" title="Ссылка на этот заголовок">¶</a></h2> <p>SQL запрос для получения идентификаторов документов в источнике.</p> <p>Полученные ID используются в запросах на получение полей документа. Запрос обязательно должен возвращать только один столбец. Полученное значение доступно во всех SQL запросах как <code class="docutils literal notranslate"><span class=pre >loot_id</span></code></p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SelectID</span> <span class=o >=</span> <span class=s >SELECT id FROM topics WHERE status = "open"</span>
<span class=na >SelectID</span> <span class=o >=</span> <span class=s >SELECT login FROM users</span>
</pre></div> </div> <h2 id=id3 ><a class=toc-backref  href="#id20">SelectFields</a><a class=headerlink  href="#id3" title="Ссылка на этот заголовок">¶</a></h2> <p>SQL запрос для получения полей документа.</p> <p>Возвращаемые строки добавляются к метаданным документа в виде полей. Названия этих полей будут соответствовать названиям столбцов.</p> <p>Для каждого документа можно выполнять любые SQL запросы подставляя в них его поля из предыдущих запросов. Для этого оберните их в <code class="docutils literal notranslate"><span class=pre >@</span></code>. Количество запросов не ограничено и начинаются с <code class="docutils literal notranslate"><span class=pre >SelectFields0</span></code>. В одном таком параметре может быть только один запрос.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SelectFields0</span> <span class=o >=</span> <span class=s >SELECT id, title, author FROM topics WHERE topic = @loot_id@</span>
<span class=na >SelectFields1</span> <span class=o >=</span> <span class=s >SELECT nickname AS user_nickname FROM users WHERE id = @author@</span>
</pre></div> </div> <p>После вышеприведённого примера документ будет иметь следующую структуру:</p> <div class="highlight-json notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
  <span class=nt >"id"</span> <span class=p >:</span> <span class=mi >535</span><span class=p >,</span>
  <span class=nt >"title"</span> <span class=p >:</span> <span class=s2 >"что это такое?"</span><span class=p >,</span>
  <span class=nt >"author"</span> <span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
  <span class=nt >"user_nickname"</span> <span class=p >:</span> <span class=s2 >"NEbot"</span>
<span class=p >}</span>
</pre></div> </div> <p>Все результаты из таких запросов будут добавлены в <strong>основные поля</strong> документа - это такие поля, которые доступны для подстановки в любые запросы (см. <a class="reference external" href="#SelectBundle">SelectBundle</a>).</p> <div class="admonition warning"> <p class=admonition-title >Предупреждение</p> <p>Такой запрос забирает только одну строку результатов. Если вам надо забрать несколько, то используйте <a class="reference external" href="#SelectBundle">SelectBundle</a>.</p> </div> <h2 id=bundlename ><a class=toc-backref  href="#id21">BundleName</a><a class=headerlink  href="#bundlename" title="Ссылка на этот заголовок">¶</a></h2> <p>Название ветви запросов.</p> <p>Поле документа, в которое будут записаны результаты данной ветви запросов (см. <a class="reference external" href="#SelectBundle">SelectBundle</a>). Количество ветвей не ограничено и начинаются с <code class="docutils literal notranslate"><span class=pre >BundleName0</span></code></p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >BundleName0</span> <span class=o >=</span> <span class=s >attachments</span>
</pre></div> </div> <h2 id=id6 ><a class=toc-backref  href="#id22">SelectBundle</a><a class=headerlink  href="#id6" title="Ссылка на этот заголовок">¶</a></h2> <p>SQL запрос из вспомогательной ветви.</p> <p>Позволяет собрать несколько значений одного поля или отдельные сущности со своим набором полей.</p> <p>Для каждой ветви обязательно нужно указать её имя <a class="reference external" href="#BundleName">BundleName</a>. Количество запросов внутри одной ветви не ограничено и начинаются с той же цифры что и её название</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >BundleName0</span> <span class=o >=</span> <span class=s >forum_posts</span>
<span class=na >SelectBundle0</span> <span class=o >=</span> <span class=s >SELECT * FROM posts</span>
<span class=na >BundleName1</span> <span class=o >=</span> <span class=s >forum_users</span>
<span class=na >SelectBundle1</span> <span class=o >=</span> <span class=s >SELECT * FROM users</span>
</pre></div> </div> <p>К примеру, можно получить посты из одной темы форума</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SelectID</span> <span class=o >=</span> <span class=s >SELECT id FROM topics</span>
<span class=na >SelectFields0</span> <span class=o >=</span> <span class=s >SELECT id, title, author FROM topics WHERE topic = @loot_id@</span>

<span class=na >BundleName0</span> <span class=o >=</span> <span class=s >posts</span>
<span class=na >SelectBundle0</span> <span class=o >=</span> <span class=s >SELECT dtm, user, text FROM posts WHERE topic = @loot_id@</span>
</pre></div> </div> <p>Тогда каждый документ получится примерно таким</p> <div class="highlight-json notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
  <span class=nt >"id"</span> <span class=p >:</span> <span class=mi >535</span><span class=p >,</span>
  <span class=nt >"title"</span> <span class=p >:</span> <span class=s2 >"что это такое?"</span><span class=p >,</span>
  <span class=nt >"author"</span> <span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
  <span class=nt >"posts"</span> <span class=p >:</span> <span class=p >[{</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"15:25:40"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"Много сайты хотят ввести это, но я не понимаю что"</span>
    <span class=p >},{</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"22:08:04"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >623</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"а ты точно не бот?"</span>
    <span class=p >}]</span>
<span class=p >}</span>
</pre></div> </div> <p>Внутри вспомогательной ветви можно так же выполнять несколько запросов и подставлять в них как основные, так поля из этой же ветви</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SelectID</span> <span class=o >=</span> <span class=s >SELECT id FROM topics</span>
<span class=na >SelectFields0</span> <span class=o >=</span> <span class=s >SELECT id, title, author FROM topics WHERE topic = @loot_id@</span>

<span class=na >BundleName0</span> <span class=o >=</span> <span class=s >posts</span>
<span class=na >SelectBundle0</span> <span class=o >=</span> <span class=s >SELECT dtm, user, text FROM posts WHERE topic = @loot_id@</span>
<span class=na >SelectBundle0-0</span> <span class=o >=</span> <span class=s >SELECT nickname FROM users WHERE id = @user@</span>
<span class=na >SelectBundle0-1</span> <span class=o >=</span> <span class=s >SELECT karma FROM users WHERE id = @user@</span>
</pre></div> </div> <p>Тогда каждый документ уже будет таким</p> <div class="highlight-json notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
  <span class=nt >"id"</span> <span class=p >:</span> <span class=mi >535</span><span class=p >,</span>
  <span class=nt >"title"</span> <span class=p >:</span> <span class=s2 >"что это такое?"</span><span class=p >,</span>
  <span class=nt >"author"</span> <span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
  <span class=nt >"posts"</span> <span class=p >:</span> <span class=p >[{</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"15:25:40"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"Много сайты хотят ввести это, но я не понимаю что"</span><span class=p >,</span>
    <span class=nt >"nickname"</span><span class=p >:</span> <span class=s2 >"NEbot"</span><span class=p >,</span>
    <span class=nt >"karma"</span><span class=p >:</span> <span class=mi >2</span>
    <span class=p >},{</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"22:08:04"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >623</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"а ты точно не бот?"</span><span class=p >,</span>
    <span class=nt >"nickname"</span><span class=p >:</span> <span class=s2 >"Джон Коннор"</span><span class=p >,</span>
    <span class=nt >"karma"</span><span class=p >:</span> <span class=mi >145</span>
    <span class=p >}]</span>
<span class=p >}</span>
</pre></div> </div> <p>У таких запросов есть ещё одно свойство - в отличии от <a class="reference external" href="#SelectFields">SelectFields</a> они могут записать несколько значений в одно поле.</p> <div class="highlight-cfg notranslate"><div class=highlight ><pre><span></span><span class=na >SelectID</span> <span class=o >=</span> <span class=s >SELECT id FROM topics</span>
<span class=na >SelectFields0</span> <span class=o >=</span> <span class=s >SELECT id, title, author FROM topics WHERE topic = @loot_id@</span>

<span class=na >BundleName0</span> <span class=o >=</span> <span class=s >posts</span>
<span class=na >SelectBundle0</span> <span class=o >=</span> <span class=s >SELECT id, dtm, user, text FROM posts WHERE topic = @loot_id@</span>
<span class=na >SelectBundle0-0</span> <span class=o >=</span> <span class=s >SELECT nickname FROM users WHERE id = @user@</span>
<span class=na >SelectBundle0-1</span> <span class=o >=</span> <span class=s >SELECT id AS attach_id, name AS attach_name FROM files WHERE post_id = @id@</span>
</pre></div> </div> <p>В этом случае документ будет таким</p> <div class="highlight-json notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
  <span class=nt >"id"</span> <span class=p >:</span> <span class=mi >535</span><span class=p >,</span>
  <span class=nt >"title"</span> <span class=p >:</span> <span class=s2 >"что это такое?"</span><span class=p >,</span>
  <span class=nt >"author"</span> <span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
  <span class=nt >"posts"</span> <span class=p >:</span> <span class=p >[{</span>
    <span class=nt >"id"</span><span class=p >:</span> <span class=mi >27897</span><span class=p >,</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"15:25:40"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >88</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"Много сайты хотят ввести это, но я не понимаю что"</span><span class=p >,</span>
    <span class=nt >"nickname"</span><span class=p >:</span> <span class=s2 >"NEbot"</span><span class=p >,</span>
    <span class=nt >"attach_id"</span><span class=p >:</span> <span class=p >[</span><span class=mi >440</span><span class=p >,</span> <span class=mi >441</span><span class=p >],</span>
    <span class=nt >"attach_name"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"foto1.jpg"</span><span class=p >,</span> <span class=s2 >"foto2.jpg"</span><span class=p >]</span>
    <span class=p >},{</span>
    <span class=nt >"id"</span><span class=p >:</span> <span class=mi >28002</span><span class=p >,</span>
    <span class=nt >"dtm"</span><span class=p >:</span> <span class=s2 >"22:08:04"</span><span class=p >,</span>
    <span class=nt >"user"</span><span class=p >:</span> <span class=mi >623</span><span class=p >,</span>
    <span class=nt >"text"</span><span class=p >:</span> <span class=s2 >"а ты точно не бот?"</span><span class=p >,</span>
    <span class=nt >"nickname"</span><span class=p >:</span> <span class=s2 >"Джон Коннор"</span>
    <span class=p >}]</span>
<span class=p >}</span>
</pre></div> </div> <div class="admonition attention"> <p class=admonition-title >Внимание</p> <p>Обратите внимание, что в запросе <code class="docutils literal notranslate"><span class=pre >SelectBundle0-1</span></code> используется поле <code class="docutils literal notranslate"><span class=pre >id</span></code>, которое есть и в основных и в вспомогательных полях. <strong>В приоритете подстановки поля из собственной ветви всегда выше основных.</strong></p> </div> <p>Таким образом можно сказать, что документ содержит тему с названием <strong>что это такое?</strong> внутри которой есть два сообщения от <strong>NEbot</strong> и <strong>Джон Коннор</strong>. Что в первом сообщении автор приложил два файла <strong>foto1.jpg</strong> и <strong>foto2.jpg</strong>.</p> <div class="admonition warning"> <p class=admonition-title >Предупреждение</p> <dl class=simple > <dt>Запросы из дополнительной ветви имеют свои ограничения:<dd><ul class=simple > <li><p>для них нельзя добавить ещё одну ветвь запросов типа <em>SelectBundle0-0-0</em></p> <li><p>они могут использовать поля только из основной или своей ветви.</p> <li><p>они могут переписать поля только внутри своей ветви.</p> </ul> </dl> </div> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href=config_export.html  title="Секция Export" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Previous </span> Секция Export </span> </div> </a> <a href=api.html  title="Команды" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Next </span> Команды </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2020, Alex Whiteeyes. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.2.1. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>