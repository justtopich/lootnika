(this["webpackJsonpreact-ant2"]=this["webpackJsonpreact-ant2"]||[]).push([[7],{524:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return z}));var s=a(95),n=a(31),c=a.n(n),r=a(408),i=a(50),l=a(43),o=a(0),u=a(72),d=a(532),b=a(124),j=a(536),p=a(157),x=a(535),h=a(163),m=a(531),O=a(411),f=a(412),k=a(162),y=a(517),S=a(97),g=a(17),_=a(32),v=a(46),w=a(534),P=a(518),L=a(537),C=a(538),I=a(539),E=a(540),N=a(542),R=a(125),T=a(543),W=a(5),A=d.a.Title,Q=d.a.Text;function z(e){var t,a,n=Object(o.useContext)(u.a),d=n.cardStatusLoading,z=n.cardStatus,B=n.statusBarConfig,F=Object.entries(z[0]),D=Object(o.useState)(3e3)[0],J=Object(o.useState)([!0])[0],M=Object(o.useState)(!0),Y=Object(l.a)(M,2),q=Y[0],G=Y[1],H=Object(o.useState)(!0),K=Object(l.a)(H,2),U=K[0],V=K[1],X=Object(o.useState)(!1),Z=Object(l.a)(X,2),$=Z[0],ee=Z[1],te=Object(o.useState)([!1])[0],ae=Object(o.useState)([!1])[0],se=Object(o.useState)({product:"",picker_type:"",version:"",directory:"",service_name:"",pid:"",pid_owner:"",client_host:"",client_role:""}),ne=Object(l.a)(se,2),ce=ne[0],re=ne[1],ie=Object(o.useState)([[{name:"",start_time:"",task_error:"",export_error:"",color1:"",color2:""}]])[0],le=Object(o.useState)({scheduler_status:"",next_start_time:"",cycles_left:"-1"}),oe=Object(l.a)(le,2),ue=oe[0],de=oe[1],be=Object(o.useState)({canStopSchedule:!1,canEnableSchedule:!1,canStopLootnika:!0,startPause:{active:!1,type:"start",loading:!1}}),je=Object(l.a)(be,2),pe=je[0],xe=je[1];function he(e,t){return me.apply(this,arguments)}function me(){return(me=Object(i.a)(c.a.mark((function e(t,a){var s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},Object.keys(t).forEach((function(e){s[e]=a[e]})),e.abrupt("return",s);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(){return fe.apply(this,arguments)}function fe(){return(fe=Object(i.a)(c.a.mark((function e(){var t,a,s,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,!te[0]){e.next=3;break}return e.abrupt("return",!1);case 3:if(te[0]=!0,!v.b){e.next=10;break}return e.next=7,Object(g.b)("a=getinfo",{status:200,data:_.a},1e3);case 7:a=e.sent,e.next=13;break;case 10:return e.next=12,Object(g.a)("a=getinfo");case 12:a=e.sent;case 13:if(!a){e.next=24;break}return e.next=16,he(ce,null===(s=a)||void 0===s?void 0:s.data);case 16:if(n=e.sent,!q){e.next=24;break}return e.next=20,he(ce,null===(r=a)||void 0===r?void 0:r.data);case 20:n=e.sent,re(n),G(!1),t=!0;case 24:return te[0]=!1,e.abrupt("return",t);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(){return ye.apply(this,arguments)}function ye(){return(ye=Object(i.a)(c.a.mark((function e(){var t,a,n,r,i,l,o,u,d,j,p,x,h,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae[0]){e.next=2;break}return e.abrupt("return");case 2:if(ae[0]=!0,!v.b){e.next=9;break}return e.next=6,Object(g.b)("a=schedule?cmd=QueueInfo&limit=5",{status:200,data:_.c},600);case 6:t=e.sent,e.next=12;break;case 9:return e.next=11,Object(g.a)("a=schedule?cmd=QueueInfo&limit=5");case 11:t=e.sent;case 12:if(t)if(a=t.data.tasks.slice(0,6),"ok"!==t.data.status)b.b.error("Load tasks: "+t.data.message),pe.canStopSchedule=!1;else{ie[0]=[],l=Object(s.a)(a);try{for(l.s();!(o=l.n()).done;)u=o.value,d="#9c9c9c",j="#9c9c9c",u.count_task_error>0&&(d="#f56e53"),u.count_export_error>0&&(j="#f56e53"),ie[0].push({name:u.name,start_time:u.start_time,task_error:u.count_task_error,export_error:u.count_export_error,color1:d,color2:j})}catch(c){l.e(c)}finally{l.f()}"-1"===(p=null===(n=t)||void 0===n?void 0:n.data.cycles_left.toString())&&(p="\u221e"),de({scheduler_status:null===(r=t)||void 0===r?void 0:r.data.scheduler_status,next_start_time:null===(i=t)||void 0===i?void 0:i.data.next_start_time,cycles_left:p}),x=!0,-1!==["cancel","ready","wait"].indexOf(t.data.scheduler_status)&&(x=!1),h=!0,"cancel"===t.data.scheduler_status&&(h=!1),m="start","pause"===t.data.scheduler_status?m="resume":"work"===t.data.scheduler_status&&(m="pause"),xe({canStopSchedule:x,canEnableSchedule:pe.canEnableSchedule,canStopLootnika:pe.canStopLootnika,startPause:{loading:!1,active:h,type:m}}),U&&V(!1)}ae[0]=!1;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(){return ge.apply(this,arguments)}function ge(){return(ge=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee(!$);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(){return(_e=Object(i.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xe({canStopSchedule:pe.canStopSchedule,canEnableSchedule:pe.canEnableSchedule,canStopLootnika:pe.canStopLootnika,startPause:{loading:pe.startPause.loading,active:pe.startPause.active,type:pe.startPause.type}}),!v.b){e.next=7;break}return e.next=4,Object(g.b)("a=stop",{status:200,data:_.d},500);case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,Object(g.a)("a=stop");case 9:t=e.sent;case 10:return t?"ok"===t.data.status?b.b.success("Lootnika is stopping..."):b.b.error(t.data.message):b.b.error("Fail to stop Lootnika"),e.next=13,Se();case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e){return we.apply(this,arguments)}function we(){return(we=Object(i.a)(c.a.mark((function e(t){var a,s,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xe({canStopSchedule:!1,canEnableSchedule:!1,canStopLootnika:!1,startPause:{loading:!0,active:pe.startPause.active,type:pe.startPause.type}}),"Resume"!==t){e.next=12;break}if(!v.b){e.next=8;break}return e.next=5,Object(g.b)("a=schedule?cmd=QueueInfo&limit=1",{status:200,data:{status:"ok",message:"returned 1 tasks",tasks:[{name:"user_topics"}]}},1200);case 5:a=e.sent,e.next=11;break;case 8:return e.next=10,Object(g.a)("a=schedule?cmd=QueueInfo&limit=1");case 10:a=e.sent;case 11:a?"ok"===a.data.status?t="Start&TaskName="+a.data.tasks[0].name:b.b.error("Error: "+a.data.message):b.b.error("Fail to execute command");case 12:if(!v.b){e.next=35;break}return e.next=15,Object(g.b)("a=schedule?cmd="+t,{status:200,data:{status:"ok",message:""}},800);case 15:if(s=e.sent,n="pause","Start&TaskName=user_topics"!==t){e.next=24;break}return e.next=20,Object(g.b)("a=schedule?cmd=QueueInfo&limit=1",{status:200,data:{status:"ok",message:"continue task user_topics"}},600);case 20:s=e.sent,n="work",e.next=32;break;case 24:if("Start"!==t){e.next=31;break}return e.next=27,Object(g.b)("a=Start",{status:200,data:{status:"ok",message:"begin all tasks"}},600);case 27:s=e.sent,n="work",e.next=32;break;case 31:"Cancel"===t&&(n="ready");case 32:_.c.scheduler_status=n,e.next=38;break;case 35:return e.next=37,Object(g.a)("a=schedule?cmd="+t);case 37:s=e.sent;case 38:s?"ok"===s.data.status?b.b.success(s.data.message):b.b.error(s.data.message):b.b.error("Fail to execute command");case 39:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return q&&!te[0]&&Oe(),U&&!ae[0]&&ke(),Object(g.d)((function(){q&&!te[0]&&Oe(),U&&!ae[0]&&ke(),q||U||(J[0]=!1)}),J[0]?D:null),Object(g.d)((function(){ke()}),3e3),Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(x.a,{title:"Stop lootnika",visible:$,onOk:function(){return function(){return _e.apply(this,arguments)}()},onCancel:function(){return Se()},okText:"Stop anyway",cancelText:"Cancel",children:[Object(W.jsx)("p",{children:"You trying to stop Lootnika"}),Object(W.jsx)("p",{children:"Lootnika control panel will not work"}),Object(W.jsx)("p",{children:"Are you sure?"})]}),Object(W.jsxs)(h.b,{align:"start",size:"middle",wrap:!0,children:[Object(W.jsxs)(m.a,{title:"Schedule",loading:U,style:{minWidth:"61em",maxWidth:"120em"},children:[Object(W.jsxs)(O.a,{justify:"space-around",style:{textAlign:"center"},children:[Object(W.jsxs)(f.a,{span:6,children:[Object(W.jsx)(A,{level:3,style:{marginBottom:0,whiteSpace:"nowrap"},children:ue.scheduler_status}),Object(W.jsx)(Q,{children:"status"})]}),Object(W.jsxs)(f.a,{span:12,children:[Object(W.jsx)(A,{level:3,style:{marginBottom:0},children:ue.next_start_time}),Object(W.jsx)(Q,{children:"next start time"})]}),Object(W.jsxs)(f.a,{span:6,children:[Object(W.jsx)(A,{level:3,style:{marginBottom:0,whiteSpace:"nowrap"},children:ue.cycles_left}),Object(W.jsx)(Q,{children:"cycles left"})]})]}),Object(W.jsx)(k.a,{orientation:"left",plain:!0,children:"Control"}),Object(W.jsxs)(O.a,{justify:"space-around",style:{textAlign:"center"},children:[Object(W.jsx)(f.a,{span:6,children:(a=pe.canEnableSchedule,a?Object(W.jsx)(j.a,{content:function(){return Object(W.jsx)("div",{children:Object(W.jsx)("p",{children:"Not working yet (\u0ca5\ufe4f\u0ca5)"})})},title:"Disable schedule",trigger:"click",children:Object(W.jsx)(p.a,{type:"primary",disabled:!pe.startPause.active,icon:Object(W.jsx)(P.a,{}),children:"Enable"})}):Object(W.jsx)(j.a,{content:function(){return Object(W.jsx)("div",{children:Object(W.jsx)("p",{children:"Not working yet (\u0ca5\ufe4f\u0ca5)"})})},title:"Disable schedule",trigger:"click",children:Object(W.jsx)(p.a,{disabled:!pe.startPause.active,icon:Object(W.jsx)(L.a,{}),children:"Disable"})}))}),Object(W.jsx)(f.a,{span:6,children:(t=pe.startPause.type,{pause:Object(W.jsx)(p.a,{className:"button-warn",type:"primary",loading:pe.startPause.loading,disabled:!pe.startPause.active,icon:Object(W.jsx)(C.a,{}),onClick:function(){return ve("Pause")},children:"Pause"}),start:Object(W.jsx)(p.a,{type:"primary",loading:pe.startPause.loading,disabled:!pe.startPause.active,icon:Object(W.jsx)(I.a,{}),onClick:function(){return ve("Start")},children:"Run once"}),resume:Object(W.jsx)(p.a,{type:"primary",loading:pe.startPause.loading,disabled:!pe.startPause.active,icon:Object(W.jsx)(E.a,{}),onClick:function(){return ve("Resume")},children:"Resume"})}[t])}),Object(W.jsx)(f.a,{span:6,children:Object(W.jsx)(p.a,{danger:!0,type:"primary",disabled:!pe.canStopSchedule,icon:Object(W.jsx)(N.a,{}),onClick:function(){return ve("Cancel")},children:"Abort task"})}),Object(W.jsx)(f.a,{span:6,children:Object(W.jsx)(p.a,{danger:!0,type:"primary",disabled:!pe.canStopLootnika,icon:Object(W.jsx)(L.a,{}),onClick:function(){return Se()},children:"Stop lootnika"})})]}),Object(W.jsx)(k.a,{orientation:"left",plain:!0,children:"Tasks problems"}),Object(W.jsx)(y.b,{dataSource:ie[0],renderItem:function(e){return Object(W.jsxs)(y.b.Item,{children:[Object(W.jsx)("span",{className:"simple-list-item",children:e.name}),Object(W.jsx)("span",{style:{paddingRight:"0.5em"},children:e.start_time}),Object(W.jsx)("span",{className:"simple-list-item",style:{float:"right"},children:Object(W.jsxs)(h.b,{align:"start",size:"small",wrap:!0,style:{fontWeight:600},children:[Object(W.jsxs)(S.a,{title:"Task errors",children:[Object(W.jsx)(R.a,{style:{color:e.color1,paddingRight:"0.2em",fontSize:"large"}}),e.task_error]}),Object(W.jsxs)(S.a,{title:"Export errors",children:[Object(W.jsx)(T.a,{style:{color:e.color2,paddingRight:"0.2em",fontSize:"large"}}),e.export_error]})]})})]})}})]}),Object(W.jsxs)(m.a,{title:"Status",loading:d,style:{minWidth:"30em",maxWidth:"60em"},children:[Object(W.jsx)("span",{children:"RAM usage"}),Object(W.jsx)(w.a,Object(r.a)({},B)),Object(W.jsx)(y.b,{dataSource:F,renderItem:function(e){return Object(W.jsxs)(y.b.Item,{style:{display:"block"},children:[Object(W.jsx)("span",{className:"simple-list-item",style:{width:"12em",display:"inline-block"},children:e[0]}),Object(W.jsx)("span",{className:"simple-list-item",style:{display:"inline-block"},children:e[1]})]})}})]}),Object(W.jsx)(m.a,{title:"Info",loading:q,style:{minWidth:"30em",maxWidth:"60em"},children:Object(W.jsx)(y.b,{dataSource:Object.entries(ce),renderItem:function(e){return Object(W.jsxs)(y.b.Item,{style:{display:"block"},children:[Object(W.jsx)("span",{className:"simple-list-item",style:{width:"10em",display:"inline-block"},children:e[0]}),Object(W.jsx)("span",{className:"simple-list-item",style:{display:"inline-block"},children:e[1]})]})}})})]})]})}}}]);
//# sourceMappingURL=7.3e20352c.chunk.js.map