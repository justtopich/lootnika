(this["webpackJsonpreact-ant2"]=this["webpackJsonpreact-ant2"]||[]).push([[7],{525:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return J}));var s=a(95),n=a(30),c=a.n(n),r=a(409),i=a(50),l=a(43),o=a(0),u=a(72),d=a(533),b=a(124),j=a(537),p=a(157),h=a(536),x=a(163),O=a(532),m=a(412),f=a(413),k=a(162),y=a(364),g=a(518),S=a(97),v=a(35),_=a(31),w=a(46),P=a(535),C=a(519),I=a(538),L=a(539),N=a(540),E=a(541),T=a(542),W=a(543),R=a(545),A=a(125),B=a(546),D=a(5),z=d.a.Title,F=d.a.Text;function J(e){var t=Object(o.useContext)(u.a),a=t.cardStatusLoading,n=t.cardStatus,d=t.statusBarConfig,J=Object.entries(n[0]),Q=Object(o.useState)(3e3)[0],M=Object(o.useState)([!0])[0],V=Object(o.useState)(!0),Y=Object(l.a)(V,2),q=Y[0],G=Y[1],H=Object(o.useState)(!0),K=Object(l.a)(H,2),U=K[0],X=K[1],Z=Object(o.useState)(!0),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ae=Object(o.useState)(!1),se=Object(l.a)(ae,2),ne=se[0],ce=se[1],re=Object(o.useState)([!1])[0],ie=Object(o.useState)([!1])[0],le=Object(o.useState)([!1])[0],oe=Object(o.useState)([[{label:"all",value:"all"}]])[0],ue=Object(o.useState)(oe[0][0].value),de=Object(l.a)(ue,2),be=de[0],je=de[1],pe=Object(o.useState)({product:"",picker_type:"",version:"",directory:"",service_name:"",pid:"",pid_owner:"",client_host:"",client_role:""}),he=Object(l.a)(pe,2),xe=he[0],Oe=he[1],me=Object(o.useState)([[{name:"",start_time:"",task_error:"",export_error:"",color1:"",color2:""}]])[0],fe=Object(o.useState)({scheduler_status:"",next_start_time:"",cycles_left:"-1"}),ke=Object(l.a)(fe,2),ye=ke[0],ge=ke[1],Se=Object(o.useState)({canStopSchedule:!1,canEnableSchedule:!1,canStopLootnika:!0,startPause:{active:!1,type:"start",loading:!1}}),ve=Object(l.a)(Se,2),_e=ve[0],we=ve[1],Pe={style:{width:200},value:be,options:oe[0],onChange:function(e){je(e)},defaultValue:oe[0][0].value,loading:ee};function Ce(e,t){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(i.a)(c.a.mark((function e(t,a){var s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},Object.keys(t).forEach((function(e){s[e]=a[e]})),e.abrupt("return",s);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(){return(Le=Object(i.a)(c.a.mark((function e(){var t,a,s,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getActualTasks"),t=!1,!le[0]){e.next=4;break}return e.abrupt("return",!1);case 4:if(le[0]=!0,!w.b){e.next=11;break}return e.next=8,Object(v.b)("a=schedule?cmd=TasksInfo",{status:200,data:_.e},1e3);case 8:a=e.sent,e.next=14;break;case 11:return e.next=13,Object(v.a)("a=schedule?cmd=TasksInfo");case 13:a=e.sent;case 14:return a&&(n=[{label:"all",value:"all"}],Object.keys(null===(s=a)||void 0===s?void 0:s.data.tasks).forEach((function(e){n.push({label:e,value:e})})),oe[0]=n,te(!1),t=!0),le[0]=!1,e.abrupt("return",t);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(i.a)(c.a.mark((function e(){var t,a,s,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updateInfo"),t=!1,!re[0]){e.next=4;break}return e.abrupt("return",!1);case 4:if(re[0]=!0,!w.b){e.next=11;break}return e.next=8,Object(v.b)("a=getinfo",{status:200,data:_.a},1e3);case 8:a=e.sent,e.next=14;break;case 11:return e.next=13,Object(v.a)("a=getinfo");case 13:a=e.sent;case 14:if(!a){e.next=25;break}return e.next=17,Ce(xe,null===(s=a)||void 0===s?void 0:s.data);case 17:if(n=e.sent,!q){e.next=25;break}return e.next=21,Ce(xe,null===(r=a)||void 0===r?void 0:r.data);case 21:n=e.sent,Oe(n),G(!1),t=!0;case 25:return re[0]=!1,e.abrupt("return",t);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(){return We.apply(this,arguments)}function We(){return(We=Object(i.a)(c.a.mark((function e(){var t,a,n,r,i,l,o,u,d,j,p,h,x,O;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ie[0]){e.next=2;break}return e.abrupt("return");case 2:if(ie[0]=!0,!w.b){e.next=9;break}return e.next=6,Object(v.b)("a=schedule?cmd=QueueInfo&limit=6",{status:200,data:_.c},600);case 6:t=e.sent,e.next=12;break;case 9:return e.next=11,Object(v.a)("a=schedule?cmd=QueueInfo&limit=6");case 11:t=e.sent;case 12:if(t)if(a=t.data.tasks.slice(0,6),"ok"!==t.data.status)b.b.error("Load tasks: "+t.data.message),_e.canStopSchedule=!1;else{me[0]=[],l=Object(s.a)(a);try{for(l.s();!(o=l.n()).done;)u=o.value,d="#9c9c9c",j="#9c9c9c",u.count_task_error>0&&(d="#f56e53"),u.count_export_error>0&&(j="#f56e53"),me[0].push({name:u.name,start_time:u.start_time,task_error:u.count_task_error,export_error:u.count_export_error,color1:d,color2:j})}catch(c){l.e(c)}finally{l.f()}"-1"===(p=null===(n=t)||void 0===n?void 0:n.data.cycles_left.toString())&&(p="\u221e"),ge({scheduler_status:null===(r=t)||void 0===r?void 0:r.data.scheduler_status,next_start_time:null===(i=t)||void 0===i?void 0:i.data.next_start_time,cycles_left:p}),h=!0,-1!==["cancel","ready","wait"].indexOf(t.data.scheduler_status)&&(h=!1),x=!0,"cancel"===t.data.scheduler_status&&(x=!1),O="start","pause"===t.data.scheduler_status?O="resume":"work"===t.data.scheduler_status&&(O="pause"),we({canStopSchedule:h,canEnableSchedule:_e.canEnableSchedule,canStopLootnika:!0,startPause:{loading:!1,active:x,type:O}}),U&&X(!1)}ie[0]=!1;case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(){return Object(D.jsx)("div",{children:Object(D.jsx)("p",{children:"Not working yet (\u0ca5\ufe4f\u0ca5)"})})}function Ae(){return Be.apply(this,arguments)}function Be(){return(Be=Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ce(!ne);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(){return(De=Object(i.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we({canStopSchedule:_e.canStopSchedule,canEnableSchedule:_e.canEnableSchedule,canStopLootnika:_e.canStopLootnika,startPause:{loading:_e.startPause.loading,active:_e.startPause.active,type:_e.startPause.type}}),!w.b){e.next=7;break}return e.next=4,Object(v.b)("a=stop",{status:200,data:_.d},500);case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,Object(v.a)("a=stop");case 9:t=e.sent;case 10:return t?"ok"===t.data.status?b.b.success("Lootnika is stopping..."):b.b.error(t.data.message):b.b.error("Fail to stop Lootnika"),e.next=13,Ae();case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(i.a)(c.a.mark((function e(t,a){var s,n,r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we({canStopSchedule:!1,canEnableSchedule:!1,canStopLootnika:!0,startPause:{loading:!0,active:_e.startPause.active,type:_e.startPause.type}}),s="all"===a?"":"&TaskName="+a,!w.b){e.next=12;break}return r="pause",i="successfully paused task "+a,"start"===t?(_.c.tasks.unshift(Object(v.c)(a,"now")),i="successfully started task "+a,r="work"):"cancel"===t&&(r="ready",i="successfully canceled task "+a),e.next=8,Object(v.b)("a=schedule?cmd="+t,{status:200,data:{status:"ok",message:i}},800);case 8:n=e.sent,_.c.scheduler_status=r,e.next=15;break;case 12:return e.next=14,Object(v.a)("a=schedule?cmd=".concat(t).concat(s));case 14:n=e.sent;case 15:n?"ok"===n.data.status?b.b.success(n.data.message):b.b.error(n.data.message):b.b.error("Fail to execute command");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}q&&!re[0]&&Ne(),U&&!ie[0]&&Te(),Object(v.e)((function(){q&&!re[0]&&Ne(),U&&!ie[0]&&Te(),ee&&function(){Le.apply(this,arguments)}(),q||U||(M[0]=!1)}),M[0]?Q:null),Object(v.e)((function(){Te()}),3e3);var Je,Qe,Me=[Object(D.jsx)(j.a,{content:Re(),title:"Disable schedule",trigger:"click",children:Object(D.jsx)(p.a,{type:"primary",icon:Object(D.jsx)(T.a,{}),loading:_e.startPause.loading,disabled:!_e.startPause.active,onClick:function(){return Re()},children:"Backup"})}),Object(D.jsx)(j.a,{content:Re(),title:"Disable schedule",trigger:"click",children:Object(D.jsx)(p.a,{type:"primary",icon:Object(D.jsx)(W.a,{}),className:"button-warn",loading:_e.startPause.loading,disabled:!_e.startPause.active,onClick:function(){return Re()},children:"Restore"})}),Object(D.jsx)(p.a,{danger:!0,type:"primary",icon:Object(D.jsx)(I.a,{}),disabled:!_e.canStopLootnika,onClick:function(){return Ae()},children:"Stop lootnika"})];return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)(h.a,{title:"Stop lootnika",visible:ne,onOk:function(){return function(){return De.apply(this,arguments)}()},onCancel:function(){return Ae()},okText:"Stop anyway",cancelText:"Cancel",children:[Object(D.jsx)("p",{children:"You trying to stop Lootnika"}),Object(D.jsx)("p",{children:"Lootnika control panel will not work"}),Object(D.jsx)("p",{children:"Are you sure?"})]}),Object(D.jsxs)(x.b,{align:"start",size:"middle",wrap:!0,children:[Object(D.jsxs)(O.a,{title:"Schedule",loading:U,style:{minWidth:"61em",maxWidth:"120em"},children:[Object(D.jsxs)(m.a,{justify:"space-around",style:{textAlign:"center"},children:[Object(D.jsxs)(f.a,{span:6,children:[Object(D.jsx)(z,{level:3,style:{marginBottom:0,whiteSpace:"nowrap"},children:ye.scheduler_status}),Object(D.jsx)(F,{children:"status"})]}),Object(D.jsxs)(f.a,{span:12,children:[Object(D.jsx)(z,{level:3,style:{marginBottom:0},children:ye.next_start_time}),Object(D.jsx)(F,{children:"next start time"})]}),Object(D.jsxs)(f.a,{span:6,children:[Object(D.jsx)(z,{level:3,style:{marginBottom:0,whiteSpace:"nowrap"},children:ye.cycles_left}),Object(D.jsx)(F,{children:"cycles left"})]})]}),Object(D.jsx)(k.a,{orientation:"left",plain:!0,children:"Control"}),Object(D.jsxs)(m.a,{justify:"space-around",style:{textAlign:"center"},children:[Object(D.jsx)(f.a,{span:6,children:Object(D.jsx)(y.a,Object(r.a)({},Pe))}),Object(D.jsx)(f.a,{span:6,children:(Qe=_e.startPause.type,{pause:Object(D.jsx)(p.a,{className:"button-warn",type:"primary",loading:_e.startPause.loading,disabled:!_e.startPause.active,icon:Object(D.jsx)(L.a,{}),onClick:function(){return ze("pause",be)},children:"Pause"}),start:Object(D.jsx)(p.a,{loading:_e.startPause.loading,disabled:!_e.startPause.active,icon:Object(D.jsx)(N.a,{}),className:"button-success",onClick:function(){return ze("start",be)},children:"Run once"}),resume:Object(D.jsx)(p.a,{loading:_e.startPause.loading,disabled:!_e.startPause.active,className:"button-success",icon:Object(D.jsx)(E.a,{}),onClick:function(){return ze("start",be)},children:"Resume"})}[Qe])}),Object(D.jsx)(f.a,{span:6,children:Object(D.jsx)(p.a,{type:"primary",disabled:!_e.canStopSchedule,icon:Object(D.jsx)(R.a,{}),onClick:function(){return ze("cancel",be)},children:"Cancel task"})}),Object(D.jsx)(f.a,{span:6,children:(Je=_e.canEnableSchedule,Je?Object(D.jsx)(j.a,{content:Re(),title:"Disable schedule",trigger:"click",children:Object(D.jsx)(p.a,{type:"primary",disabled:!_e.startPause.active,icon:Object(D.jsx)(C.a,{}),children:"Enable"})}):Object(D.jsx)(j.a,{content:Re(),title:"Disable schedule",trigger:"click",children:Object(D.jsx)(p.a,{disabled:!_e.startPause.active,icon:Object(D.jsx)(I.a,{}),children:"Disable"})}))})]}),Object(D.jsx)(k.a,{orientation:"left",plain:!0,children:"Last tasks"}),Object(D.jsx)(g.b,{dataSource:me[0],renderItem:function(e){return Object(D.jsxs)(g.b.Item,{children:[Object(D.jsx)("span",{className:"simple-list-item",children:e.name}),Object(D.jsx)("span",{style:{paddingRight:"0.5em"},children:e.start_time}),Object(D.jsx)("span",{className:"simple-list-item",style:{float:"right"},children:Object(D.jsxs)(x.b,{align:"start",size:"small",wrap:!0,style:{fontWeight:600},children:[Object(D.jsxs)(S.a,{title:"Task errors",children:[Object(D.jsx)(A.a,{style:{color:e.color1,paddingRight:"0.2em",fontSize:"large"}}),e.task_error]}),Object(D.jsxs)(S.a,{title:"Export errors",children:[Object(D.jsx)(B.a,{style:{color:e.color2,paddingRight:"0.2em",fontSize:"large"}}),e.export_error]})]})})]})}})]}),Object(D.jsxs)(O.a,{title:"Status",loading:a,style:{minWidth:"30em",maxWidth:"60em"},children:[Object(D.jsx)("span",{children:"RAM usage"}),Object(D.jsx)(P.a,Object(r.a)({},d)),Object(D.jsx)(g.b,{dataSource:J,renderItem:function(e){return Object(D.jsxs)(g.b.Item,{style:{display:"block"},children:[Object(D.jsx)("span",{className:"simple-list-item",style:{width:"12em",display:"inline-block"},children:e[0]}),Object(D.jsx)("span",{className:"simple-list-item",style:{display:"inline-block"},children:e[1]})]})}})]}),Object(D.jsx)(O.a,{title:"Info",loading:q,style:{minWidth:"30em",maxWidth:"60em"},children:Object(D.jsx)(g.b,{dataSource:Object.entries(xe),renderItem:function(e){return Object(D.jsxs)(g.b.Item,{style:{display:"block"},children:[Object(D.jsx)("span",{className:"simple-list-item",style:{width:"10em",display:"inline-block"},children:e[0]}),Object(D.jsx)("span",{className:"simple-list-item",style:{display:"inline-block"},children:e[1]})]})}})}),Object(D.jsx)(O.a,{title:"Control",loading:q,style:{minWidth:"30em",maxWidth:"60em"},children:Object(D.jsx)(g.b,{dataSource:Me,renderItem:function(e){return Object(D.jsx)(g.b.Item,{style:{display:"block"},children:e})}})})]})]})}}}]);
//# sourceMappingURL=7.963d82ee.chunk.js.map